---
title: 关系数据模型要素二 （关系操作集合）
date: 2019-09-18 19:15:49
categories:
- Datebase basis
tags:
- relational operation
---
 <link href="/static/css/relation_data_model.css" rel="stylesheet"  type="text/css"/>

### 基本的关系操作

增（插入 Insert）、删(Delete)、改(Update)、查（Query）。关系的查询表达能力是关系操作最主要的部分。查又可分为选择、投影、连接、除、并、差、交、笛卡尔积。集合操作方式（操作的对象和结果都是集合）。又称为一次一集合（set-at-a-time）

### 关系数据语言的分类
通过关系语言实现关系操作。<label>它高度非过程化</label>用户不必请求DBM为其建立特殊的存取路径，由 DBMS 的优化机制来完成。

1. 代数方式：主要有关系代数，通过对关系的操作来表达查询要求
2. 逻辑方式：主要有关系演算，是用谓词来表达查询要求，关系演算又按谓词变元的基本对象（元组变量或域变量），分为元组关系演算和域关系演算。
3. 介于前两者之间的结构化查询语言（Structured Query Language,SQL）：SQL具有丰富的查询功能、数据定义和数据控制功能。集查询、数据定义语言（DDL）、数据操作语言（DML）和数据控制语言（Data Control Language, DCL）于一体；是关系数据库的标准语言。

### 关系代数

关系代数是关系操作语言中的传统表示方式，以集合代数为基础发展而来。任何一种操作都是将一定的操作符作用域一定的操作对象上，得到预期的操作结果。
<label>操作包含三大要素：操作对象、操作符、操作结果。</label>而对象和结果均为关系。关系代数直接应用关系的运算来表达操作的目的，运算符包括集合运算符和专门的关系运算符。

{% raw %}
<table cellpadding="5" id="operator" >
<caption>关系代数的运算符</caption>
<thead>
<th colspan = "2">运算符</th>
<th >含义</th>
</thead>
<tbody>
<tr>
<td rowspan="4">集合运算符</td>
<td>∪</td>
<td>并</td>
</tr>

<tr>
<td>−</td>
<td>差</td>
</tr>

<tr>
<td>∩</td>
<td>交</td>
</tr>

<tr>
<td>×</td>
<td>笛卡尔积</td>
</tr>



<tr>
<td rowspan="4">专门的关系运算符</td>
<td>σ</td>
<td>选择</td>
</tr>

<tr>
<td>π</td>
<td>投影</td>
</tr>

<tr>
<td>⋈</td>
<td>连接</td>
</tr>

<tr>
<td>÷</td>
<td>除</td>
</tr>


<tr>
<td rowspan="6">比较操作符</td>
<td> > </td>
<td>大于</td>
</tr>

<tr>
<td>≥</td>
<td>大于等于</td>
</tr>

<tr>
<td> < </td>
<td>小于</td>
</tr>

<tr>
<td>≤</td>
<td>小于等于</td>
</tr>
<tr>
<td>＝</td>
<td>等于</td>
</tr>
<tr>
<td>≠</td>
<td>不等于</td>
</tr>

<tr>
<td rowspan="3">比较操作符</td>
<td> ¬ </td>
<td>非</td>
</tr>

<tr>
<td>∧</td>
<td>与</td>
</tr>

<tr>
<td> ∨ </td>
<td>或</td>
</tr>

</tbody>
</table>
{% endraw %}

关系代数操作经过有限次复合的式子称为关系代数操作表达式（关系代数表达式），可使用表达式表示所需要执行的各种数据查询和修改处理，所有关系代数是一种抽象的查询语言，通过对关系的操作来表达查询。

按运算符分类，关系代数操作可分为：传统的集合运算和专门的关系运算

### 集合运算

传统集合运算是二目运算，将关系看成元组集合，运算从行的角度来进行，具有 并、差、交、迪卡尔积四种运算。

**Example：**

**表 T1**

|学号（SNO）|姓名（SNAME）|性别(SSEX)|宿舍(SROOM)|
|:-:|:-:|:-:|:-:|
|0001|张三|男|N101|
|0002|王二|男|N101|
|0003|李梅|女|C101|

**表 T2**

|学号（SNO）|姓名（SNAME）|性别(SSEX)|宿舍(SROOM)|
|:-:|:-:|:-:|:-:|
|0004|刘八|男|D101|
|0005|赵二|男|B201|
|0003|李梅|女|C101|


#### 并（UNION）

表T1 和 表T2 使用并运算产生一个新表T3，（T3 = T1 ∪ T2）它是由T1和T2所有不同元组所组成，且 T1和T2属性个数、值域相同。下表为 T1 ∪ T2的结果
**表 T3**

|学号（SNO）|姓名（SNAME）|性别(SSEX)|宿舍(SROOM)|
|:-:|:-:|:-:|:-:|
|0001|张三|男|N101|
|0002|王二|男|N101|
|0003|李梅|女|C101|
|0004|刘八|男|D101|
|0005|赵二|男|B201|


#### 差（DIFFERENCE）

表T1 和 表T2 使用差运算产生一个新表T4，（T4 = T1 - T2）它有T1的所有元组但不包含T2的元组，且 T1和T2属性个数、值域必须相同。下表为 T1 - T2的结果

**表 T4**

|学号（SNO）|姓名（SNAME）|性别(SSEX)|宿舍(SROOM)|
|:-:|:-:|:-:|:-:|
|0001|张三|男|N101|
|0002|王二|男|N101|

#### 交（INTERSECTION）

表T1 和 表T2 使用交运算产生一个新表T5，（T5 = T1 ∩ T2）它同时包含T1和T2相同的所有元组，且 T1和T2属性个数、值域必须相同，交运算可由差运算表示（T1∩T2 = T1-(T1-T2)）。下表为 T1 ∩ T2的结果

**表 T5**

|学号（SNO）|姓名（SNAME）|性别(SSEX)|宿舍(SROOM)|
|:-:|:-:|:-:|:-:|
|0003|李梅|女|C101|

##### 笛卡尔积（CARTESIAN PRODUCT）

表T6 和 表T7 使用笛卡尔积运算产生一个新表T8，（T8 = T6 × T7）它是T6和T7的所有元组连接而成，即将两张表的元关系合并，且T6的每一元组都对应T7所有的元组
下表为 T6 × T7的结果

**表 T6**

|学号（SNO）|姓名（SNAME）|
|:-:|:-:|
|0001|张三|
|0002|王二|

**表 T7**

|课程号（CNO）|课程名（CNAME）|教室(SSEX)|
|:-:|:-:|:-:|
|1|数据库|C-101|
|2|操作系统|C-102|

**表 T8**

|学号（SNO）|姓名（SNAME）|课程号（CNO）|课程名（CNAME）|教室(SSEX)|
|:-:|:-:|:-:|:-:|:-:|
|0001|张三|1|数据库|C-101|
|0001|张三|2|操作系统|C-102|
|0002|王二|1|数据库|C-101|
|0002|王二|2|操作系统|C-102|

### 专门的关系运算

此运算即涉及行，又涉及列，分为一元专门关系操作和二元专门关系操作
- 一元关系操作：对单个关系进行垂直分解的投影运算和进行水平分解选择运算
- 二元关系操作：对两个关系进行操作，包括连运算和除运算


#### 选择（SELECT）

选择运算( $σ_F(R)$ )，F为条件表达式，R为指定的被运算关系名。 从指定关系中选取满足条件的若干元组组成一个新关系
```SQL
SELECT 关系名 WHERE 条件语句（表达式）
```
条件语句：由常数、属性名或列名、比较操作符及逻辑操作符组成

**Example：**
```SQL
SELECT T8 WHERE 姓名 = "张三"
```

**表 T9**

|学号（SNO）|姓名（SNAME）|课程号（CNO）|课程名（CNAME）|教室(SSEX)|
|:-:|:-:|:-:|:-:|:-:|
|0001|张三|1|数据库|C-101|
|0001|张三|2|操作系统|C-102|


#### 投影（PROJECTION）

投影运算( $π_A(R)$ ), R为被运算关系，A为属性序列，从指定关系中选取指定的若干属性值组成新关系
```SQL
PROJECTION 关系名 ( 属性名1, 属性名2 ,... )
```
组成的新关系自动去重

**Example：**
```SQL
PROJECTION T8 (课程号,课程名)
```

**表 T10**

|课程号（CNO）|课程名（CNAME）|
|:-:|:-:|:-:|
|1|数据库|
|2|操作系统|



#### θ连接（JOIN）
连接运算（$R\cfrac{⋈}{xθy}S$）,其中，R和S 代表两个不同的关系；x 和 y 分别表示R中的第x列和S中的第y列属性；θ表示比较运算符，从笛卡尔积R×S中选取R的第x列属性值与S的第y列属性值满足θ的那些元组组成一个新关系。

```SQL
JOIN 关系1 AND 关系2 WHERE 条件语句
```
条件语句：由比较操作符和属性名或列名组成的表达式

- 等值连接：θ值为 "="，从R和S的笛卡尔积中选取 x、y 属性值相等的元组

**Example：**

**表 T11**

|A|B|C|
|:-:|:-:|:-:|
|a|b|c|
|d|e|f|

**表 T12**

|D|E|A|
|:-:|:-:|:-:|
|g|h|a|
|b|c|d|

```SQL
JOIN  T11 AND T12 WHERE B= A
```

**T11 × T12**

|A|B|C|D|E|A|
|:-:|:-:|:-:|:-:|:-:|:-:|
|a|b|c|g|h|a|
|a|b|c|b|c|d|
|d|e|f|g|h|a|
|d|e|f|b|c|d|

等值结果为：

**表 T13**

|A|B|C|D|E|A|
|:-:|:-:|:-:|:-:|:-:|:-:|
|a|b|c|b|c|d|


- 自然连接：是一种特殊的等值连接，要求两个关系中比较的分量必须是 <span style="color:red">相同的属性组，且结果中去除重复的属性列</span>

```SQL
JOIN  T11 AND T12 WHERE A = A
```

**表 T14**

|A|B|C|D|E|
|:-:|:-:|:-:|:-:|:-:|
|a|b|c|g|h|
|d|e|f|b|c|

自然连接是构造新关系的有效方法，投影和选择是分解关系的有效方法，自然连接中如果两个关系没有公共属性则变成笛卡尔积

#### 除（DIVISION）
除运算（R÷S） R和S代表两个不同的关系。
假如被除关系R 为 m 元关系，除关系S 为 n 元关系，则运算结果的新关系为 m-n元关系。

**Example 1：**

**表 T15**

|A|B|C|D|E|F|G
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|a|b|c|d|e|f|g|
|h|i|j|k|l|m|n|
|a|b|c|a|b|c|d|
|a|c|e|f|b|m|n|

**表 T16**

|F|G|
|:-:|:-:|
|f|g|
|m|n|

运算步骤：

1. 被除关系R对除关系S不同的属性 X 进行投影


**X 投影**

|A|B|C|D|E|
|:-:|:-:|:-:|:-:|:-:|
|a|b|c|d|e|
|h|i|j|k|l|
|a|b|c|a|b|
|a|c|e|f|b|

待续。。。

2. 提取每个属性集值对应S元关系的象集

2.1 |a|b|c|d|e| 值的象集

|A|B|C|D|E|
|:-:|:-:|:-:|:-:|:-:|
|f|g|

2.2 |h|i|j|k|l| 值的象集

|A|B|C|D|E|
|:-:|:-:|:-:|:-:|:-:|
|m|n|

2.3 |a|b|c|a|b| 值的象集

|A|B|C|D|E|
|:-:|:-:|:-:|:-:|:-:|
|c|d|

2.4 |a|c|e|f|b| 值的象集

|A|B|C|D|E|
|:-:|:-:|:-:|:-:|:-:|
|m|n|

3. S 关系在公共属性 F G 的投影

|F|G|
|:-:|:-:
|f|g|
|m|n|

通过 3 和 2 的对比 R÷S 为空

**Example 2：**
